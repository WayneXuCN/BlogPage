---
title: Deploying a Linux Server for Academic Research
author: Wenjie Xu
pubDatetime: 2024-08-24 14:34:28
modDatetime: 2024-11-01 14:34:28
description: How to deploy a Linux server
tags:
  - Ubuntu
  - Productivity
  - Deployment
  - Server
category: Productivity
featured: false
draft: false
slug: en/deploy-linux-for-research
lang: en
---

Recently, I converted a MiniPC into a server running the Ubuntu operating system, configuring it to meet potential future research needs.

Given my limited knowledge of Linux, I spent some time learning and attempting to complete the deployment, and recorded the configuration steps, possible issues, and their corresponding solutions.

## Table of Contents

---

## Creating a New User with Administrator Privileges on Ubuntu

When using a cloud service, provider-supplied, or self-configured Ubuntu server, a default user is created. Typically, this user can temporarily elevate privileges using the `sudo` command to perform tasks requiring administrator rights, but it is essentially a regular user (not an administrator account). If you need to create a custom user with the same administrator privileges, follow these steps:

### 1. Create a new user and specify home directory, login shell

```bash
sudo useradd -d "/home/<user_name>" -m -s "/bin/bash" <user_name>
```

Parameter explanation:

- `-d "/home/<user_name>"`: Sets the user's home directory to `/home/<user_name>`.
- `-m`: Automatically creates the home directory.
- `-s "/bin/bash"`: Specifies the user's default login shell as `/bin/bash`.

### 2. Grant administrator privileges to the new user

To create a user with sudo (administrator) privileges, run the following command:

```bash
sudo useradd -d "/home/<user_name>" -m -s "/bin/bash" -G sudo <user_name>
```

Where:

- `-G sudo`: Adds `<user_name>` to the `sudo` user group, granting administrator privileges.

### 3. Set a password for the new user

Newly created users do not have a password by default. Set a password for `<user_name>` using the following command:

```bash
sudo passwd <user_name>
```

After running this command, the system will prompt for the password twice. Note that for security reasons, no characters will be displayed when entering the password (no text or asterisks). Simply enter the password and press `Enter` to confirm.

Through these steps, you can successfully create a new user `<user_name>` with administrator privileges, who can execute commands using `sudo`.

---

## Terminal Command Beautification

A good-looking and useful terminal prompt can enhance work enjoyment. Here, we use `zsh` to beautify the terminal, with operations referring to [previous records](/blog/2022/Linux实用配置记录/).

---

## Enabling Remote Access to the Server

To enable remote access to the Ubuntu server from locations other than its physical location, you can install and configure SSH service, along with necessary firewall configurations.

### 1. Install and configure SSH service

If only basic SSH access is needed, installing `openssh-server` and enabling the SSH service is sufficient. However, in environments with higher security requirements, you can further optimize the SSH configuration file `/etc/ssh/sshd_config`:

```bash
sudo apt update
sudo apt install openssh-server
```

After installation, check the status of the SSH service to confirm it is running properly:

```bash
sudo systemctl status ssh
```

- **Configuration recommendations**:
  - **Disable direct root user login** (recommended): Avoid logging in directly as root to increase security. In `/etc/ssh/sshd_config`, find `PermitRootLogin` and set it to `no`.

    ```bash
    sudo nano /etc/ssh/sshd_config
    ```

    ```plaintext
    PermitRootLogin no
    ```

  - **Restrict allowed users**: You can specify users allowed to log in via SSH through the `AllowUsers` configuration item to further strengthen security.

    ```plaintext
    AllowUsers <user_name>
    ```

  - **Use a non-default port** (optional): Change the SSH port from the default 22 to another port, such as 2200. This method can reduce the possibility of scanning attacks, but you need to update firewall rules accordingly.

    ```plaintext
    Port 2200
    ```

  - **Enable automatic disconnection of idle connections**: To prevent unused SSH sessions from occupying resources for long periods, add the following lines to the configuration to set automatic disconnection of idle connections.

    ```plaintext
    ClientAliveInterval 300
    ClientAliveCountMax 2
    ```

After changes, restart the SSH service to apply the configuration:

```bash
sudo systemctl restart ssh
```

### 2. Configure UFW firewall

If UFW firewall is enabled, ensure the SSH port is open, and configure accordingly if the port has been changed. If using the default port 22, you can use:

```bash
sudo ufw allow ssh
```

If the port has been changed, such as to 2200, use the following command:

```bash
sudo ufw allow 2200/tcp
```

- **Configuration recommendations:**
  - After enabling the firewall, check the status to ensure rules are applied correctly:

    ```bash
    sudo ufw enable
    sudo ufw status
    ```

### 3. Verify SSH connection

Test the connection to the server from a client system (such as Windows). On Windows, it is recommended to use SSH protocol-supporting terminal tools like [PuTTY](https://www.putty.org/) or [Windows Terminal](https://aka.ms/terminal) to ensure connection security and stability.

To test remote connection to the server on a Windows system, you can use the telnet command (note: telnet is often used for testing connections, but in production environments, use a more secure SSH client):

```bash
telnet <remote_ip> <remote_port>
```

Replace <remote_ip> with the server's IP address, and <remote_port> with the SSH port the server is listening on (default is 22).

### 4. Fix .Xauthority file permission issues

The `.Xauthority` file permission error in `/home/<user_name>/.Xauthority` may occur because the file was created without root privileges. In addition to modifying the ownership of the user directory, ensure the permissions of related SSH session directories are correct:

```bash
sudo chown <user_name>:<user_name> -R /home/<user_name>
```

If the issue persists, try creating a new `.Xauthority` file:

```bash
sudo -u <user_name> touch /home/<user_name>/.Xauthority
sudo chown <user_name>:<user_name> /home/<user_name>/.Xauthority
```

### 5. Set up Fail2Ban (recommended)

To further protect the SSH service from brute-force attacks, you can install and configure `fail2ban`. This tool automatically detects multiple failed login attempts and temporarily disables the corresponding IP:

```bash
sudo apt install fail2ban
```

`fail2ban` will automatically enable SSH protection, and you can customize the `/etc/fail2ban/jail.local` file to adjust ban time, retry counts, etc.:

```plaintext
[sshd]
enabled = true
port = 22
maxretry = 5
bantime = 600
```

Fail2Ban will automatically identify multiple failed login attempts and disable the corresponding IP, further securing the server.

---

## Configuring SSH Connection Between Server and GitHub

The following are detailed steps to configure SSH connection between the Ubuntu server and GitHub, ensuring secure cloning, pushing, and pulling of repositories on GitHub.

### 1. Install and verify Git

First, install Git and confirm the installed version:

```bash
sudo apt install git
git --version
```

### 2. Configure Git user information

Configure Git with your GitHub username and email. Ensure the information matches your GitHub account to correctly record authorship when committing code:

```bash
git config --global user.name "<github_account_name>"
git config --global user.email "<github_account_email>"
```

This configuration will be added to the `~/.gitconfig` file and is global, applying to all Git repositories under this user.

### 3. Generate SSH key pair

To establish a secure connection with GitHub on the server, generate an SSH key pair:

```bash
ssh-keygen -C "<github_account_email>" -t rsa
```

- Explanation:
  - `-C "<github_account_email>"`: Adds a comment to the key, typically the GitHub account email.
  - `-t rsa`: Specifies the key type as RSA (a commonly supported type by GitHub).

After running the command, press `Enter` three times (keeping the default filename `id_rsa` and no passphrase), and the key pair will be stored in the `~/.ssh` directory.

### 4. Add SSH public key to GitHub

1. Use the following command to open the generated public key file and copy its contents:

   ```bash
   cat ~/.ssh/id_rsa.pub
   ```

   This command prints the public key in the terminal; you can optionally open it with a text editor and copy (e.g., using `vim ~/.ssh/id_rsa.pub`).

2. Log in to GitHub website and navigate to `Settings` → `SSH and GPG keys` → `New SSH key`.

3. Paste the contents of `id_rsa.pub` into the `New SSH key` page, set a descriptive title (e.g., `Ubuntu Server Key`), and save.

### 5. Test SSH connection with GitHub

After configuration, test the connection with GitHub using the following command:

```bash
ssh -T git@github.com
```

When executing this command, GitHub will return a message confirming successful connection, such as:

```plaintext
Hi <github_account_name>! You've successfully authenticated, but GitHub does not provide shell access.
```

This message indicates that the SSH connection has been successfully established, allowing code pushing and pulling with GitHub on the server.

### 6. Common issues and solutions

1. **SSH key permission issues**: Ensure the permissions of the SSH key pair files are correct to prevent connection issues. Check and set key permissions:

   ```bash
   chmod 600 ~/.ssh/id_rsa
   chmod 644 ~/.ssh/id_rsa.pub
   ```

2. **Add key to SSH Agent** (recommended): If the key is not automatically loaded after server startup, add it to the SSH Agent for automatic loading after each reboot:

   ```bash
   eval "$(ssh-agent -s)"
   ssh-add ~/.ssh/id_rsa
   ```

---

## Python Environment Configuration and Management

---

### Miniforge

For managing Python scientific environments on the server, I chose the lightweight and efficient Miniforge as a package manager, replacing Anaconda. Miniforge defaults to the conda-forge channel and integrates Mamba, providing faster package management solutions. Below are the steps for installing and configuring Miniforge, as well as creating and deleting environments.

#### 1. Install Miniforge

First, follow the installation instructions on Miniforge's [GitHub project page](https://github.com/conda-forge/miniforge) for downloading and installation. The core installation commands are:

```bash
wget "https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-$(uname)-$(uname -m).sh"
bash Miniforge3-$(uname)-$(uname -m).sh
```

- Configuration recommendations:
  - It is recommended to install Miniforge in `/usr/local/miniforge3`, allowing multiple users to share environments, but only root can modify. During installation, you can choose the directory, and the system will automatically create necessary folders.

  - If using ZSH, confirm that Miniforge's path is added to the `.zshrc` file.

    ```bash
    export PATH="$usr/local/miniforge3/bin:$PATH"
    ```

  - Reload `.zshrc` configuration: `source ~/.zshrc`

#### 2. Initialize Mamba environment

After installation, initialize Mamba to use the command in the terminal. Assuming Miniforge is installed in `/usr/local/miniforge3`, execute:

```bash
/usr/local/miniforge3/bin/mamba init
```

This command initializes environment variables and requires restarting the terminal to apply changes.

If ZSH doesn't work, you can copy the `mamba` configuration from `.bashrc` to `.zshrc`, or configure otherwise.

#### 3. Create and manage environments

In a multi-user server environment, it is recommended to create and manage environments with root privileges (switch using `sudo su`). This prevents ordinary users from accidentally or uncontrollably changing environment configurations.

##### Create new environment

```bash
# Create new environment with specified name
mamba create --name <new_env_name> python=3.11 --no-default-packages
```

- `--name <new_env_name>`: Names the new environment.
- `python=3.11`: Sets Python version to 3.11.
- `--no-default-packages`: Installs only Python, without automatically installing other packages.
- Ordinary users can create private environments in their home directory (e.g., `/home/username/myenv`), executing:

```bash
mamba create --prefix /home/username/myenv python=3.11 --no-default-packages
```

##### Delete environment

To delete an environment (including all associated packages), use:

```bash
# Delete by environment name
mamba remove --name <env_name> --all
# Delete by path
mamba remove --prefix /path/to/directory --all
```

#### 4. Install common packages

It is generally recommended not to modify the `base` environment directly, but to create dedicated environments based on actual needs. For example, you may need to install `JupyterHub`, which provides Jupyter notebook services for multiple users.

```bash
# Create Machine Learning environment
mamba create --name ml_env python=3.12 jupyterhub jupyterlab notebook notebook scipy numpy numpy
# Activate environment
mamba activate ml_env
# Install other packages
mamba install jupyter-lsp-python jupyterlab-lsp jupyterlab-git jupyterlab_execute_time
```

#### 5. Prevent unauthorized updates

In multi-user environments, restricting ordinary users from modifying system-level environments helps maintain stability. If users try to update the environment, they will encounter permission errors. Example:

```bash
mamba update --all
```

Error message:

```plaintext
EnvironmentNotWritableError: The current user does not have write permissions to the target environment.
  environment location: /usr/local/miniforge3
  uid: 1000
  gid: 1000
```

This design ensures environment security and consistency, avoiding update failures due to permissions.

If you need to temporarily grant permission to update the `base` environment, use the `sudo` command:

```bash
sudo /usr/local/miniforge3/bin/mamba update --all
```

---

### Poetry

Poetry is an efficient and convenient Python project dependency management tool, suitable for quickly creating and managing virtual environments, installing dependency libraries, and publishing Python packages.

#### 1. Install Poetry

Before installing Poetry, ensure Python 3.7 or higher is installed.

1. Use the official installation script:

   Poetry's installation script automatically installs Poetry in the `$HOME/.local/bin` directory. Run the following command to download and execute the installation script:

   ```bash
   curl -sSL https://install.python-poetry.org | python3 -
   ```

2. Add Poetry to PATH:

   After default installation, you need to add Poetry to environment variables. If you get a `command not found` error, you can add it to the current session's environment variables with:

   ```bash
   export PATH="$HOME/.local/bin:$PATH"
   ```

3. Verify installation:

   After installation, check the installed version to confirm success:

   ```bash
   poetry --version
   ```

#### 2. Create new project

Poetry provides simplified commands to quickly generate the basic structure of new projects.

1. Create new project:

   Use the following command to create a new project directory (e.g., `my_project`) and generate the default `pyproject.toml` file.

   ```bash
   poetry new my_project
   ```

   This command will generate the following structure in the project directory:

   ```
   my_project/
   ├── my_project/
   │   └── __init__.py
   ├── pyproject.toml
   └── tests/
       └── __init__.py
   ```

2. Initialize existing project (optional):

   If a project already exists and you want to manage it with Poetry, you can initialize it with `poetry init`. This command will guide the generation of the `pyproject.toml` file and configure initial dependencies:

   ```bash
   cd existing_project
   poetry init
   ```

#### 3. Manage project dependencies

Poetry provides convenient dependency management, distinguishing between production and development dependencies.

1. **Add production dependencies**:

   Add dependencies to the production environment, such as the `requests` library:

   ```bash
   poetry add requests
   ```

2. **Add development dependencies**:

   If certain libraries are only for development and testing, use the `--dev` parameter. This adds dependencies to the `[tool.poetry.dev-dependencies]` section. For example, add `pytest` as a development dependency:

   ```bash
   poetry add pytest --dev
   ```

3. **Install all dependencies**:

   After writing project dependencies to the `pyproject.toml` file, install all dependencies with:

   ```bash
   poetry install
   ```

   `poetry install` automatically creates a virtual environment and installs required dependencies within it. If a `poetry.lock` file exists, it ensures installed dependency versions match those in the lock file for environment consistency.

---

#### 4. Manage virtual environments

Poetry creates virtual environments outside the project directory and automatically activates and uses them.

1. **Activate virtual environment**:

   Activate the virtual environment created by Poetry with:

   ```bash
   poetry shell
   ```

2. **Exit virtual environment**:

   After finishing work in the virtual environment, enter `exit` to exit.

3. **View virtual environment path**:

   To view the actual storage path of the virtual environment:

   ```bash
   poetry env info --path
   ```

4. **Delete virtual environment** (optional):

   If you need to recreate or clean up the environment, delete the virtual environment:

   ```bash
   poetry env remove python
   ```

#### 5. Manage dependency lock file

Poetry uses the `poetry.lock` file to lock exact dependency versions, ensuring consistency across environments.

1. **Update dependency versions**:

   When updating dependency versions, re-resolve dependencies and update the lock file with:

   ```bash
   poetry update
   ```

2. **Install specified lock versions**:

   In collaborative projects, team members can install the project's exact dependency versions based on the `poetry.lock` file:

   ```bash
   poetry install
   ```

#### 6. Run scripts and commands

Poetry supports running scripts or commands directly in the virtual environment, simplifying command management.

1. **Run project scripts**:

   Use `poetry run` to execute commands in the virtual environment. For example, run a Python script:

   ```bash
   poetry run python script.py
   ```

2. **Run unit tests directly**:

   Run test commands like `pytest` directly in the virtual environment:

   ```bash
   poetry run pytest
   ```

#### 7. Publish Python packages

Poetry can publish projects to [PyPI](https://pypi.org/) or other custom package repositories.

1. **Build project**:

   Poetry provides one-click project building, packaging the project into `.whl` and `.tar.gz` files for publishing:

   ```bash
   poetry build
   ```

2. **Publish to PyPI**:

   To publish to PyPI, configure PyPI credentials in the `~/.pypirc` file, or use Poetry's `publish` command to enter interactively:

   ```bash
   poetry publish --build
   ```

   > **Note**: To verify the publishing process in a test environment, use the `--repository` parameter to publish to the PyPI test repository.

   ```bash
   poetry publish --repository testpypi
   ```

---

The following is a configuration guide for using R environment in econometrics, including installing R and RStudio, common R package configurations, etc.

---

## Configuring R Environment on Ubuntu for Econometric Analysis

In the field of econometrics, R is suitable for handling economic data, performing regression analysis, time series analysis, etc.

### 1. Install R

Ubuntu's default software repository includes R, but it may not be the latest version. To get the latest R version, use the CRAN repository.

1. **Add CRAN repository**:

   Update the package list and install necessary dependencies:

   ```bash
   sudo apt update
   sudo apt install software-properties-common dirmngr -y
   ```

2. **Add R project's GPG key**:

   Download and add CRAN's GPG public key to ensure package integrity:

   ```bash
   wget -qO- https://cloud.r-project.org/bin/linux/ubuntu/marutter_pubkey.asc | sudo tee -a /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc
   ```

3. **Verify GPG key** (optional):

   Verify the key's fingerprint (`E298A3A825C0D65DFD57CBB651716619E084DAB9`):

   ```bash
   gpg --show-keys /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc
   ```

4. **Add CRAN repository to source list**:

   Add the CRAN repository to the apt source list to ensure the latest R version:

   ```bash
   sudo add-apt-repository "deb https://cloud.r-project.org/bin/linux/ubuntu $(lsb_release -cs)-cran40/"
   ```

5. **Install R and development packages**:

   Install the latest R version and development libraries:

   ```bash
   sudo apt install r-base r-base-dev -y
   ```

### 2. Install RStudio

RStudio is a powerful IDE suitable for data analysis and visualization. The installation process for RStudio is straightforward; refer to the [official RStudio installation guide](https://posit.co/download/rstudio-server/) for specific steps.

**Installation steps**:

1. Download the latest version of RStudio Server.

2. Install using the `dpkg` command:

   ```bash
   sudo dpkg -i rstudio-server-<version>.deb
   ```

3. Check installation status:

   ```bash
   sudo systemctl status rstudio-server
   ```

After successful installation of RStudio Server, access it via `http://<your-server-ip>:8787` in the browser.

### 3. Install econometrics-related R packages

Econometric analysis typically requires specialized packages for data processing, regression analysis, and time series analysis.

1. **Install system dependencies**:

   Install system-level development packages to ensure smooth R package installation (especially for packages requiring compilation, like `tidyverse` and `data.table`):

   ```bash
   sudo apt-get install build-essential libssl-dev libcurl4-openssl-dev libxml2-dev
   ```

2. **Install econometrics and data processing packages**:

   Launch the R console and install commonly used econometrics packages:

   ```bash
   sudo R
   ```

   Execute the following commands in the R console:

   ```r
   chooseCRANmirror(graphics = FALSE)
   install.packages(c("tidyverse", "data.table", "broom", "plm", "forecast", "lmtest", "sandwich", "stargazer"))
   ```

   - `tidyverse`: Includes `dplyr`, `ggplot2`, `tidyr`, etc., for data processing and visualization.
   - `data.table`: For fast data processing.
   - `broom`: Tidies regression analysis results into analyzable tables.
   - `plm`: For panel data regression analysis.
   - `forecast`: For time series forecasting and analysis.
   - `lmtest` and `sandwich`: Provide econometric testing tools and robust standard errors.
   - `stargazer`: Outputs regression results as easy-to-understand tables, suitable for papers or reports.

3. **Install advanced econometric tools**:
   - `AER` (Applied Econometrics with R): Contains common functions and datasets for economic research.
   - `urca`: Provides unit root and cointegration tests.
   - `vars`: For vector autoregression (VAR) analysis.

   ```r
   install.packages(c("AER", "urca", "vars"))
   ```

4. **Install financial time series analysis packages** (optional):
   - `quantmod` and `TTR`: For financial market data analysis and technical indicator calculations.
   - `zoo` and `xts`: For handling irregular time series data.

   ```r
   install.packages(c("quantmod", "TTR", "zoo", "xts"))
   ```

### 4. Install private packages using GitHub token

If you need to install experimental or custom packages from GitHub, it is recommended to use a GitHub token to avoid API rate limits.

**Generate GitHub token**:

1. Generate a token in the R console:

   ```r
   usethis::create_github_token()
   ```

2. Generate a new Personal Access Token on the GitHub website (path: `Settings` → `Developer settings` → `Personal access token` → `Tokens (classic)`).

3. **Configure GitHub token**:

   Add the generated token to the R environment:

   ```r
   gitcreds::gitcreds_set()
   ```

Under this setup, you can securely install private packages from GitHub without API restrictions.

### 5. Example: Install and use `plm` package for panel data regression

Assuming you want to perform regression analysis using panel data, here's how to install `plm` and run a fixed effects model:

1. **Install `plm`** (if not installed):

   ```r
   install.packages("plm")
   ```

2. **Load and use `plm`**:

   ```r
   library(plm)

   # Create example panel dataset
   data("Produc", package = "plm")
   pdata <- pdata.frame(Produc, index = c("state", "year"))

   # Fixed effects model regression
   fe_model <- plm(log(gsp) ~ log(pcap) + log(hwy) + log(water) + log(util), data = pdata, model = "within")
   summary(fe_model)
   ```

The following is an organized and optimized guide to help more effectively sync data, install fonts, and handle Nvidia driver and library version mismatch issues.

---

## Other Issues

---

### 1. Sync data

To sync local data to a remote server, it is recommended to use `rsync`, an efficient and reliable synchronization method. For more details, refer to [this tutorial](https://www.digitalocean.com/community/tutorials/how-to-use-rsync-to-sync-local-and-remote-directories).

- **Sync command**:

  ```bash
  rsync -r /path/to/sync/ <username>@<remote_host>:<destination_directory>
  ```

  The above command will "push" all contents of the local directory `/path/to/sync/` to the remote server's `<destination_directory>`.

- **Monitor large file transfer progress**:

  If syncing large files, use the `watch` command to monitor sync progress:

  ```bash
  watch -n <time_interval> du -sh /path/to/large/file
  ```

  This command refreshes the file size change every `<time_interval>` seconds.

---

### 2. Install common fonts

Linux systems do not come with some common fonts from Windows by default (such as `Arial` and `Times New Roman`). Installing these fonts can improve the display of documents and websites, especially graphical outputs that depend on these fonts. Install the Microsoft TrueType core fonts package and refresh the cache:

```bash
sudo apt install msttcorefonts
rm -rf ~/.cache/matplotlib
```

- `msttcorefonts` includes various Microsoft fonts like Arial and Times New Roman.
- The second command removes the `matplotlib` cache directory to ensure updated fonts load correctly.

---

### 3. Driver/library version mismatch

When running `nvidia-smi`, if you encounter the following error:

```text
Failed to initialize NVML: Driver/library version mismatch
```

Refer to the solution on [Stack Overflow](https://stackoverflow.com/questions/43022843/nvidia-nvml-driver-library-version-mismatch/45319156#45319156). The brief steps are:

1. **Reboot the server**:
   In some cases, rebooting the server resolves the issue:

   ```bash
   sudo reboot
   ```

2. **Uninstall and reinstall Nvidia drivers**:

   If rebooting doesn't work, try the following commands to clear existing Nvidia drivers and reinstall:

   ```bash
   sudo apt purge nvidia* libnvidia*
   sudo ubuntu-drivers install
   sudo reboot
   ```

---

### 4. Upgrade Nvidia drivers

To upgrade Nvidia drivers, follow these steps:

1. **Uninstall old drivers**:

   ```bash
   sudo apt purge *nvidia* -y
   sudo apt remove *nvidia* -y
   sudo rm /etc/apt/sources.list.d/cuda*
   sudo apt autoremove -y && sudo apt autoclean -y
   sudo rm -rf /usr/local/cuda*
   ```

2. **Find and install recommended drivers**:

   Run the following command to find the recommended Nvidia driver version:

   ```bash
   ubuntu-drivers devices
   ```

   Or install a specific version (e.g., `550`, adjust version number based on system needs):

   ```bash
   sudo apt install libnvidia-common-550-server libnvidia-gl-550-server nvidia-driver-550-server -y
   ```

3. **Reboot and check**:

   Reboot the server and use `nvidia-smi` to check if the new driver is working properly:

   ```bash
   sudo reboot now
   ```

   If `nvidia-smi` returns the following error:

   ```text
   NVIDIA-SMI has failed because it couldn't communicate with the NVIDIA driver.
   ```

   Try reinstalling kernel headers and rebooting.

---

### 5. Install kernel headers and configure GCC

If you encounter kernel header or GCC version issues, follow these steps:

1. **Reinstall kernel headers**:

   ```bash
   sudo apt install --reinstall linux-headers-$(uname -r)
   sudo reboot
   ```

2. **Update GCC version**:

   If GCC errors occur during kernel header installation, upgrade to `gcc-12`:

   ```bash
   sudo apt-get install gcc-12
   sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-12 12
   ```

   After reinstalling kernel headers and rebooting the server, `nvidia-smi` should work properly.
